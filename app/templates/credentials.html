{% extends 'base.html' %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-8">
    <div class="card">
      <div class="card-header">
        <h4 class="mb-0">Zerodha API Credentials</h4>
        <small class="text-muted">Connect your Zerodha account for live trading data</small>
      </div>
      <div class="card-body">
        
        <!-- OAUTH LOGIN SECTION (NEW!) -->
        <div class="alert alert-primary" role="alert">
          <h5 class="alert-heading">
            <i class="bi bi-lightning-charge-fill"></i> Quick Connect (Recommended)
          </h5>
          <p class="mb-3">
            Click below to automatically get a fresh access token by logging into your Zerodha account.
            This is the easiest way - no copy/pasting required!
          </p>
          <hr>
          <div class="d-grid gap-2 col-md-6 mx-auto">
            <a href="{{ url_for('auth.zerodha_login') }}" class="btn btn-primary btn-lg">
              <i class="bi bi-box-arrow-in-right"></i> Login with Zerodha
            </a>
          </div>
          <small class="text-muted d-block mt-2 text-center">
            You'll be redirected to Zerodha's secure login page
          </small>
        </div>
        
        <!-- Current Status -->
        {% if has_credentials %}
        <div class="alert alert-success" role="alert">
          <i class="bi bi-check-circle-fill"></i> <strong>Credentials Configured</strong>
          <br>
          <small>Your access token is active. Tokens expire after 24 hours.</small>
        </div>
        {% else %}
        <div class="alert alert-warning" role="alert">
          <i class="bi bi-exclamation-triangle-fill"></i> <strong>No Credentials Configured</strong>
          <br>
          <small>You need to connect your Zerodha account to use live monitoring features.</small>
        </div>
        {% endif %}
        
        <!-- Divider -->
        <div class="text-center my-4">
          <span class="text-muted">— OR —</span>
        </div>
        
        <!-- MANUAL ENTRY SECTION (Kept as backup) -->
        <details>
          <summary class="text-muted" style="cursor: pointer;">
            <i class="bi bi-pencil-square"></i> <strong>Enter Credentials Manually</strong> (Advanced Users)
          </summary>
          
          <div class="mt-3">
            <form method="post">
              <div class="mb-3">
                <label for="api_key" class="form-label">API Key *</label>
                <input type="text" class="form-control" id="api_key" name="api_key" 
                       placeholder="Enter your Zerodha API Key" required>
                <div class="form-text">Get this from Zerodha Developer Console</div>
              </div>
              
              <div class="mb-3">
                <label for="access_token" class="form-label">Access Token *</label>
                <input type="text" class="form-control" id="access_token" name="access_token" 
                       placeholder="Enter your Access Token" required>
                <div class="form-text">
                  <strong>Note:</strong> Token expires daily. Using "Login with Zerodha" above is much easier!
                </div>
              </div>
              
              <div class="alert alert-info" role="alert">
                <strong><i class="bi bi-info-circle"></i> Manual setup steps:</strong>
                <ol class="mb-0 mt-2 small">
                  <li>Visit <a href="https://developers.kite.trade/" target="_blank">Zerodha Developer Console</a></li>
                  <li>Create an app to get your API Key</li>
                  <li>Login to Kite Connect to get Access Token</li>
                  <li>Paste both values above</li>
                </ol>
              </div>
              
              <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <button type="submit" class="btn btn-outline-primary">
                  <i class="bi bi-save"></i> Save Manually
                </button>
              </div>
            </form>
          </div>
        </details>
        
        <!-- Navigation -->
        <hr class="my-4">
        <div class="d-grid gap-2 d-md-flex justify-content-md-start">
          <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Back to Dashboard
          </a>
        </div>
        
      </div>
    </div>
  </div>
</div>
{% endblock %}